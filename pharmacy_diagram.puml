@startuml Диаграмма состояний - Веб-приложение аптечной сети

skinparam backgroundColor #FEFEFE
skinparam state {
    BackgroundColor<<main>> LightBlue
    BackgroundColor<<process>> LightYellow
    BackgroundColor<<decision>> LightCoral
    BackgroundColor<<end>> LightGreen
}

[*] --> ОткрытиеПриложения

state "Пользователь открывает\nприложение" as ОткрытиеПриложения
state "Пользователь авторизован?" as ПроверкаАвторизации <<decision>>
state "Отобразить сообщение\nоб ошибке" as ОшибкаАвторизации
state "Отобразить главную страницу" as ГлавнаяСтраница

ОткрытиеПриложения --> ПроверкаАвторизации
ПроверкаАвторизации --> ГлавнаяСтраница : да
ПроверкаАвторизации --> ОшибкаАвторизации : нет
ОшибкаАвторизации --> [*]

/' Модуль поиска лекарств '/
state "Поиск лекарств" as МодульПоиска {
    state "Пользователь вводит\nназвание препарата" as ВводПоискового
    state "Запрос данных\nиз базы" as ЗапросПоиска
    state "Отображение\nрезультатов поиска" as ОтображениеРезультатов
    state "Выбор препарата" as ВыборЛекарства
    state "Проверка наличия\nв аптеках" as ПроверкаНаличия
    state "Препарат доступен?" as ПроверкаДоступности <<decision>>
    state "Добавление в корзину" as ДобавлениеВКорзину
    state "Подписка на\nуведомление о поступлении" as УведомлениеОПоступлении
    
    [*] --> ВводПоискового
    ВводПоискового --> ЗапросПоиска
    ЗапросПоиска --> ОтображениеРезультатов
    ОтображениеРезультатов --> ВыборЛекарства
    ВыборЛекарства --> ПроверкаНаличия
    ПроверкаНаличия --> ПроверкаДоступности
    ПроверкаДоступности --> ДобавлениеВКорзину : В наличии
    ПроверкаДоступности --> УведомлениеОПоступлении : Нет в наличии
    ДобавлениеВКорзину --> [*]
    УведомлениеОПоступлении --> [*]
}

/' Модуль управления рецептами '/
state "Управление рецептами" as МодульРецептов {
    state "Пользователь выбирает действие" as ВыборДействияРецепт
    state "Выбрать действие" as РешениеДействия <<decision>>
    state "Загрузка рецепта" as ЗагрузкаРецепта
    state "Валидация рецепта" as ВалидацияРецепта
    state "Рецепт действителен?" as ПроверкаВалидности <<decision>>
    state "Сохранение рецепта" as СохранениеРецепта
    state "Сообщение об ошибке\nрецепта" as ОшибкаРецепта
    state "Просмотр списка\nрецептов" as ПросмотрРецептов
    state "Проверка срока\nдействия рецептов" as ПроверкаСрока
    
    [*] --> ВыборДействияРецепт
    ВыборДействияРецепт --> РешениеДействия
    РешениеДействия --> ЗагрузкаРецепта : Загрузить новый
    РешениеДействия --> ПросмотрРецептов : Мои рецепты
    РешениеДействия --> ПроверкаСрока : Проверить срок
    
    ЗагрузкаРецепта --> ВалидацияРецепта
    ВалидацияРецепта --> ПроверкаВалидности
    ПроверкаВалидности --> СохранениеРецепта : Действителен
    ПроверкаВалидности --> ОшибкаРецепта : Недействителен
    
    СохранениеРецепта --> [*]
    ОшибкаРецепта --> [*]
    ПросмотрРецептов --> [*]
    ПроверкаСрока --> [*]
}

/' Модуль оформления заказа '/
state "Оформление заказа" as МодульЗаказа {
    state "Просмотр корзины" as ПросмотрКорзины
    state "Редактирование\nкорзины" as РедактированиеКорзины
    state "Выбор способа получения" as ВыборСпособаПолучения
    state "Способ получения?" as РешениеПолучения <<decision>>
    state "Выбор аптеки" as ВыборАптеки
    state "Ввод адреса доставки" as ВводАдреса
    state "Проверка наличия\nв выбранной аптеке" as ПроверкаНаличияВАптеке
    state "Расчет стоимости\nдоставки" as РасчетДоставки
    state "Товар/доставка доступны?" as ПроверкаДоступностиЗаказа <<decision>>
    state "Предложение\nальтернативных вариантов" as ПредложениеАльтернатив
    state "Выбор способа оплаты" as ВыборОплаты
    state "Способ оплаты?" as РешениеОплаты <<decision>>
    state "Оплата онлайн" as ОплатаОнлайн
    state "Оплата при получении" as ОплатаПриПолучении
    state "Подтверждение оплаты" as ПодтверждениеОплаты
    state "Оплата прошла?" as ПроверкаОплаты <<decision>>
    state "Создание заказа" as СозданиеЗаказа
    state "Уведомление о заказе" as УведомлениеОЗаказе
    state "Сообщение об ошибке\nоплаты" as ОшибкаОплаты
    
    [*] --> ПросмотрКорзины
    ПросмотрКорзины --> РедактированиеКорзины : Изменить количество
    РедактированиеКорзины --> ПросмотрКорзины
    ПросмотрКорзины --> ВыборСпособаПолучения : Оформить заказ
    
    ВыборСпособаПолучения --> РешениеПолучения
    РешениеПолучения --> ВыборАптеки : Самовывоз
    РешениеПолучения --> ВводАдреса : Доставка
    
    ВыборАптеки --> ПроверкаНаличияВАптеке
    ВводАдреса --> РасчетДоставки
    
    ПроверкаНаличияВАптеке --> ПроверкаДоступностиЗаказа
    РасчетДоставки --> ПроверкаДоступностиЗаказа
    
    ПроверкаДоступностиЗаказа --> ВыборОплаты : Доступно
    ПроверкаДоступностиЗаказа --> ПредложениеАльтернатив : Недоступно
    ПредложениеАльтернатив --> ВыборАптеки : Выбрать другую аптеку
    ПредложениеАльтернатив --> [*] : Отменить заказ
    
    ВыборОплаты --> РешениеОплаты
    РешениеОплаты --> ОплатаОнлайн : Онлайн оплата
    РешениеОплаты --> ОплатаПриПолучении : При получении
    
    ОплатаОнлайн --> ПодтверждениеОплаты
    ПодтверждениеОплаты --> ПроверкаОплаты
    ПроверкаОплаты --> СозданиеЗаказа : Успешно
    ПроверкаОплаты --> ОшибкаОплаты : Ошибка
    
    ОплатаПриПолучении --> СозданиеЗаказа
    
    СозданиеЗаказа --> УведомлениеОЗаказе
    УведомлениеОЗаказе --> [*]
    
    ОшибкаОплаты --> ВыборОплаты : Повторить попытку
    ОшибкаОплаты --> [*] : Отменить
}

ГлавнаяСтраница --> МодульПоиска : Поиск препаратов
ГлавнаяСтраница --> МодульРецептов : Управление рецептами
ГлавнаяСтраница --> МодульЗаказа : Корзина

МодульПоиска --> ГлавнаяСтраница : Возврат
МодульРецептов --> ГлавнаяСтраница : Возврат
МодульЗаказа --> ГлавнаяСтраница : Возврат

note right of МодульПоиска
  Модуль позволяет искать препараты
  по названию и добавлять их в корзину
end note

note right of МодульРецептов
  Управление электронными рецептами:
  загрузка, валидация, проверка сроков
end note

note right of МодульЗаказа
  Полный цикл оформления заказа
  с выбором способа получения и оплаты
end note

@enduml
