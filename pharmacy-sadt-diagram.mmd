graph TB
    %% Входные данные
    I1["Запрос пользователя<br/>(название препарата)"]
    
    %% Процесс A1: Поиск лекарств
    subgraph A1["A1: Поиск и выбор лекарств"]
        direction TB
        C1["⬇ УПРАВЛЕНИЕ ⬇<br/>Каталог лекарств<br/>Классификация АТХ<br/>Рецептурность"]
        P1[" "]
        M1["⬆ МЕХАНИЗМ ⬆<br/>Мобильное приложение<br/>API-сервер<br/>База данных"]
    end
    
    I1 -->|"ВХОД ➡"| A1
    A1 -->|"➡ ВЫХОД"| O1["Список найденных<br/>товаров с наличием<br/>и ценами"]
    
    %% Процесс A2: Оформление заказа
    subgraph A2["A2: Оформление заказа"]
        direction TB
        C2["⬇ УПРАВЛЕНИЕ ⬇<br/>Правила заказа<br/>Ограничения рецептурности<br/>Минимальная сумма"]
        P2[" "]
        M2["⬆ МЕХАНИЗМ ⬆<br/>Пользователь<br/>Мобильное приложение<br/>Система управления заказами"]
    end
    
    O1 --> I2["Выбранные товары<br/>Количество"]
    I2 -->|"ВХОД ➡"| A2
    A2 -->|"➡ ВЫХОД"| O2["Созданный заказ<br/>Номер заказа<br/>Резерв товаров"]
    
    %% Процесс A3: Обработка платежа
    subgraph A3["A3: Обработка платежа"]
        direction TB
        C3["⬇ УПРАВЛЕНИЕ ⬇<br/>Правила безопасности<br/>PCI DSS<br/>Требования ЦБ РФ"]
        P3[" "]
        M3["⬆ МЕХАНИЗМ ⬆<br/>Платёжный шлюз<br/>Банк-эквайер<br/>API платёжной системы"]
    end
    
    O2 --> I3["Данные заказа<br/>Сумма к оплате<br/>Способ оплаты"]
    I3 -->|"ВХОД ➡"| A3
    A3 -->|"➡ ВЫХОД"| O3["Подтверждение оплаты<br/>Чек<br/>Обновлённый статус"]
    
    %% Процесс A4: Обработка в аптеке
    subgraph A4["A4: Обработка заказа в аптеке"]
        direction TB
        C4["⬇ УПРАВЛЕНИЕ ⬇<br/>Фармацевтические нормы<br/>Проверка рецептов ЕГИСЗ<br/>Сроки годности"]
        P4[" "]
        M4["⬆ МЕХАНИЗМ ⬆<br/>Фармацевт<br/>Система управления аптекой<br/>Сканер штрих-кодов"]
    end
    
    O3 --> I4["Подтверждённый заказ<br/>Список товаров<br/>Рецепты (если есть)"]
    I4 -->|"ВХОД ➡"| A4
    A4 -->|"➡ ВЫХОД"| O4["Собранный заказ<br/>Проверенные рецепты<br/>Документы"]
    
    %% Процесс A5: Выдача/Доставка
    subgraph A5["A5: Выдача или доставка заказа"]
        direction TB
        C5["⬇ УПРАВЛЕНИЕ ⬇<br/>Регламент выдачи<br/>Правила доставки<br/>Срок хранения заказа"]
        P5[" "]
        M5["⬆ МЕХАНИЗМ ⬆<br/>Фармацевт / Курьер<br/>Мобильное приложение<br/>Система трекинга"]
    end
    
    O4 --> I5["Собранный заказ<br/>Код выдачи<br/>Адрес доставки"]
    I5 -->|"ВХОД ➡"| A5
    A5 -->|"➡ ВЫХОД"| O5["Выданный заказ<br/>Подтверждение получения<br/>Начисленные бонусы"]
    
    %% Обратная связь
    O5 --> FB["Обратная связь<br/>Отзывы, оценки"]
    FB -.->|Цикл обратной связи| I1
    
    %% Стили
    style A1 fill:#e3f2fd,stroke:#000,stroke-width:3px
    style A2 fill:#fff9c4,stroke:#000,stroke-width:3px
    style A3 fill:#f3e5f5,stroke:#000,stroke-width:3px
    style A4 fill:#c8e6c9,stroke:#000,stroke-width:3px
    style A5 fill:#ffe0b2,stroke:#000,stroke-width:3px
    
    style I1 fill:#fff,stroke:#000
    style O1 fill:#fff,stroke:#000
    style I2 fill:#fff,stroke:#000
    style O2 fill:#fff,stroke:#000
    style I3 fill:#fff,stroke:#000
    style O3 fill:#fff,stroke:#000
    style I4 fill:#fff,stroke:#000
    style O4 fill:#fff,stroke:#000
    style I5 fill:#fff,stroke:#000
    style O5 fill:#fff,stroke:#000
    style FB fill:#ffcdd2,stroke:#000
