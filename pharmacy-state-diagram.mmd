stateDiagram-v2
    [*] --> Создан : Пользователь<br/>оформляет заказ
    
    Создан --> ОжидаетОплаты : Выбран способ<br/>оплаты онлайн
    Создан --> ПринятВОбработку : Выбрана оплата<br/>при получении
    Создан --> Отменён : Пользователь<br/>отменяет заказ
    
    ОжидаетОплаты --> Оплачен : Платёж<br/>успешно проведён
    ОжидаетОплаты --> Отменён : Ошибка оплаты<br/>или тайм-аут
    
    Оплачен --> ПринятВОбработку : Аптека получает<br/>уведомление
    
    ПринятВОбработку --> Готовится : Фармацевт<br/>начинает сборку
    
    Готовится --> ГотовКВыдаче : Заказ собран<br/>(самовывоз)
    Готовится --> ГотовКДоставке : Заказ собран<br/>(доставка)
    Готовится --> Отменён : Товара нет<br/>в наличии
    
    ГотовКВыдаче --> Выдан : Клиент забрал<br/>заказ в аптеке
    ГотовКВыдаче --> Отменён : Клиент не забрал<br/>в течение 3 дней
    
    ГотовКДоставке --> ВДоставке : Курьер принял<br/>заказ
    
    ВДоставке --> Доставлен : Курьер доставил<br/>клиенту
    ВДоставке --> ГотовКДоставке : Неудачная<br/>попытка доставки
    
    Выдан --> Завершён : Заказ<br/>подтверждён
    Доставлен --> Завершён : Заказ<br/>подтверждён
    
    Завершён --> [*]
    Отменён --> [*]
    
    note right of Создан
        Начальное состояние.
        Заказ только что создан
    end note
    
    note right of ОжидаетОплаты
        Ожидание платежа
        от платёжной системы
    end note
    
    note left of ПринятВОбработку
        Аптека проверяет
        наличие товаров
    end note
    
    note left of Готовится
        Фармацевт собирает заказ,
        проверяет рецепты
    end note
    
    note right of ГотовКВыдаче
        Push-уведомление
        клиенту о готовности
    end note
    
    note right of ВДоставке
        Трекинг доставки
        в реальном времени
    end note
    
    note right of Отменён
        Конечное состояние.
        Возврат средств (если оплачен)
    end note
    
    note right of Завершён
        Конечное состояние.
        Начисление бонусов
    end note
